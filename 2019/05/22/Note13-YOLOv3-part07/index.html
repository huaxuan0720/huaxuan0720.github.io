<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>YOLOv3源码阅读：data_utils.py - Welcome to My Blogs</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta name="description" content="一、YOLO简介   YOLO（You Only Look Once）是一个高效的目标检测算法，属于One-Stage大家族，针对于Two-Stage目标检测算法普遍存在的运算速度慢的缺点，YOLO创造性的提出了One-Stage。也就是将物体分类和物体定位在一个步骤中完成。YOLO直接在输出层回归bounding box的位置和bounding box所属类别，从而实现one-stage。">
<meta name="keywords" content="深度学习,目标检测,YOLOv3">
<meta property="og:type" content="article">
<meta property="og:title" content="YOLOv3源码阅读：data_utils.py">
<meta property="og:url" content="http://huaxuan0720.github.io/2019/05/22/Note13-YOLOv3-part07/index.html">
<meta property="og:site_name" content="Welcome to My Blogs">
<meta property="og:description" content="一、YOLO简介   YOLO（You Only Look Once）是一个高效的目标检测算法，属于One-Stage大家族，针对于Two-Stage目标检测算法普遍存在的运算速度慢的缺点，YOLO创造性的提出了One-Stage。也就是将物体分类和物体定位在一个步骤中完成。YOLO直接在输出层回归bounding box的位置和bounding box所属类别，从而实现one-stage。">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://huaxuan0720.github.io/gallery/DeepLearning.jpg">
<meta property="og:updated_time" content="2019-09-03T07:21:54.054Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="YOLOv3源码阅读：data_utils.py">
<meta name="twitter:description" content="一、YOLO简介   YOLO（You Only Look Once）是一个高效的目标检测算法，属于One-Stage大家族，针对于Two-Stage目标检测算法普遍存在的运算速度慢的缺点，YOLO创造性的提出了One-Stage。也就是将物体分类和物体定位在一个步骤中完成。YOLO直接在输出层回归bounding box的位置和bounding box所属类别，从而实现one-stage。">
<meta name="twitter:image" content="http://huaxuan0720.github.io/gallery/DeepLearning.jpg">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/github-gist.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    

    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/favicon.svg" alt="YOLOv3源码阅读：data_utils.py" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">主页</a>
                
                <a class="navbar-item" href="/archives/">归档</a>
                
                <a class="navbar-item" href="/categories/">类别</a>
                
                <a class="navbar-item" href="/tags/">标签</a>
                
                <a class="navbar-item" href="/about/">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Xuan Hua&#39;s GitHub" href="https://www.github.com/huaxuan0720">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-image">
        <span class="image is-7by1">
            <img class="thumbnail" src="/gallery/DeepLearning.jpg" alt="YOLOv3源码阅读：data_utils.py">
        </span>
    </div>
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <i class="fas fa-angle-double-right"></i>YOLOv3源码阅读：data_utils.py
            
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-05-22T08:56:02.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2019-05-22</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2019-09-03T07:21:54.054Z"><i class="far fa-calendar-check">&nbsp;</i>2019-09-03</time>
                
                
                <div class="level-item">
                <i class="far fa-folder-open has-text-grey"></i>&nbsp;
                <a class="has-link-grey -link" href="/categories/目标检测/">目标检测</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    <i class="far fa-clock"></i>&nbsp;
                    
                    
                    17 minutes read (About 2581 words)
                </span>
                
                
                <span class="level-item has-text-grey" id="busuanzi_container_page_pv">
                    <i class="far fa-eye"></i>
                    <span id="busuanzi_value_page_pv">0</span> visits
                </span>
                
            </div>
        </div>
        
        <div class="content">
            <h5 id="一yolo简介">一、YOLO简介</h5>
<p>  YOLO（You Only Look Once）是一个高效的目标检测算法，属于One-Stage大家族，针对于Two-Stage目标检测算法普遍存在的运算速度慢的缺点，YOLO创造性的提出了One-Stage。也就是将物体分类和物体定位在一个步骤中完成。YOLO直接在输出层回归bounding box的位置和bounding box所属类别，从而实现one-stage。</p>
<p>  经过两次迭代，YOLO目前的最新版本为<a href="https://pjreddie.com/media/files/papers/YOLOv3.pdf" target="_blank" rel="noopener">YOLOv3</a>，在前两版的基础上，YOLOv3进行了一些比较细节的改动，效果有所提升。</p>
<p>  本文正是希望可以将源码加以注释，方便自己学习，同时也愿意分享出来和大家一起学习。由于本人还是一学生，如果有错还请大家不吝指出。</p>
<a id="more"></a>
<p>  本文参考的源码地址为：<a href="https://github.com/wizyoung/YOLOv3_TensorFlow" class="uri" target="_blank" rel="noopener">https://github.com/wizyoung/YOLOv3_TensorFlow</a></p>
<h5 id="二代码和注释">二、代码和注释</h5>
<p>  文件目录：YOUR_PATH\YOLOv3_TensorFlow-master_utils.py</p>
<p>  这一部分代码主要是准备训练用的数据。算得上是YOLO模型中另一个十分重要的部分。 <figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> division, print_function</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np</span><br><span class="line"><span class="hljs-keyword">import</span> cv2</span><br><span class="line"><span class="hljs-keyword">import</span> sys</span><br><span class="line"><span class="hljs-keyword">from</span> utils.data_aug <span class="hljs-keyword">import</span> *</span><br><span class="line"><span class="hljs-keyword">import</span> random</span><br><span class="line"></span><br><span class="line">PY_VERSION = sys.version_info[<span class="hljs-number">0</span>]</span><br><span class="line">iter_cnt = <span class="hljs-number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_line</span><span class="hljs-params">(line)</span>:</span></span><br><span class="line">    <span class="hljs-string">'''</span></span><br><span class="line"><span class="hljs-string">    Given a line from the training/test txt file, return parsed info.</span></span><br><span class="line"><span class="hljs-string">    return:</span></span><br><span class="line"><span class="hljs-string">        line_idx: int64</span></span><br><span class="line"><span class="hljs-string">        pic_path: string.</span></span><br><span class="line"><span class="hljs-string">        boxes: shape [N, 4], N is the ground truth count, elements in the second</span></span><br><span class="line"><span class="hljs-string">            dimension are [x_min, y_min, x_max, y_max]</span></span><br><span class="line"><span class="hljs-string">        labels: shape [N]. class index.</span></span><br><span class="line"><span class="hljs-string">    '''</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    这一部分代码的主要功能是对给定的数据字符串进行处理，提取出其中的有效信息，包括如下：</span></span><br><span class="line"><span class="hljs-string">    1. 图片索引</span></span><br><span class="line"><span class="hljs-string">    2. 图片路径</span></span><br><span class="line"><span class="hljs-string">    3. 每一个目标框的坐标，</span></span><br><span class="line"><span class="hljs-string">    4. 每一个目标框的label</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line">    <span class="hljs-keyword">if</span> <span class="hljs-string">'str'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> str(type(line)):</span><br><span class="line">        line = line.decode()</span><br><span class="line">    <span class="hljs-comment"># 按照空格划分数据</span></span><br><span class="line">    s = line.strip().split(<span class="hljs-string">' '</span>)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 第一个数据是图片索引</span></span><br><span class="line">    line_idx = int(s[<span class="hljs-number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 第二个数据是图片的路径</span></span><br><span class="line">    pic_path = s[<span class="hljs-number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 去除掉前两个数据之后，剩下的就和目标框有关系了</span></span><br><span class="line">    s = s[<span class="hljs-number">2</span>:]</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 每一个目标框都包含五个数据，4个坐标信息和1个label信息，因此数据总数除以5之后就是目标框的总数目</span></span><br><span class="line">    box_cnt = len(s) // <span class="hljs-number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 存储数据的list</span></span><br><span class="line">    boxes = []</span><br><span class="line">    labels = []</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 对每一个目标框</span></span><br><span class="line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(box_cnt):</span><br><span class="line">        <span class="hljs-comment"># 提取出label以及四个坐标数据</span></span><br><span class="line">        label, x_min, y_min, x_max, y_max = int(s[i * <span class="hljs-number">5</span>]), float(s[i * <span class="hljs-number">5</span> + <span class="hljs-number">1</span>]), float(s[i * <span class="hljs-number">5</span> + <span class="hljs-number">2</span>]), float(</span><br><span class="line">            s[i * <span class="hljs-number">5</span> + <span class="hljs-number">3</span>]), float(s[i * <span class="hljs-number">5</span> + <span class="hljs-number">4</span>])</span><br><span class="line">        boxes.append([x_min, y_min, x_max, y_max])</span><br><span class="line">        labels.append(label)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># numpy处理一下</span></span><br><span class="line">    boxes = np.asarray(boxes, np.float32)</span><br><span class="line">    labels = np.asarray(labels, np.int64)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 返回</span></span><br><span class="line">    <span class="hljs-keyword">return</span> line_idx, pic_path, boxes, labels</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_box</span><span class="hljs-params">(boxes, labels, img_size, class_num, anchors)</span>:</span></span><br><span class="line">    <span class="hljs-string">'''</span></span><br><span class="line"><span class="hljs-string">    Generate the y_true label, i.e. the ground truth feature_maps in 3 different scales.</span></span><br><span class="line"><span class="hljs-string">    params:</span></span><br><span class="line"><span class="hljs-string">        boxes: [N, 5] shape, float32 dtype. `x_min, y_min, x_max, y_mix, mixup_weight`.</span></span><br><span class="line"><span class="hljs-string">        labels: [N] shape, int64 dtype.</span></span><br><span class="line"><span class="hljs-string">        class_num: int64 num.</span></span><br><span class="line"><span class="hljs-string">        anchors: [9, 4] shape, float32 dtype.</span></span><br><span class="line"><span class="hljs-string">    '''</span></span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    这一部分是数据预处理中最重要的一部分,因为这里才是生成最后的y true的地方</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line">    <span class="hljs-comment"># anchor的编号,分别对应于每一个不同尺寸的特征图,</span></span><br><span class="line">    <span class="hljs-comment"># 大尺寸的特征图对应的anchor是6,7,8,中尺寸的特征图对应的是3,4,5,小尺寸的对应的是0,1,2</span></span><br><span class="line">    anchors_mask = [[<span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>]]</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># convert boxes form:</span></span><br><span class="line">    <span class="hljs-comment"># shape: [N, 2]</span></span><br><span class="line">    <span class="hljs-comment"># (x_center, y_center)</span></span><br><span class="line">    <span class="hljs-comment"># 计算目标框的中心坐标</span></span><br><span class="line">    box_centers = (boxes[:, <span class="hljs-number">0</span>:<span class="hljs-number">2</span>] + boxes[:, <span class="hljs-number">2</span>:<span class="hljs-number">4</span>]) / <span class="hljs-number">2</span></span><br><span class="line">    <span class="hljs-comment"># (width, height)</span></span><br><span class="line">    <span class="hljs-comment"># 计算目标框的大小</span></span><br><span class="line">    box_sizes = boxes[:, <span class="hljs-number">2</span>:<span class="hljs-number">4</span>] - boxes[:, <span class="hljs-number">0</span>:<span class="hljs-number">2</span>]</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># [13, 13, 3, 5+num_class+1] `5` means coords and labels. `1` means mix up weight.</span></span><br><span class="line">    <span class="hljs-comment"># 储存数据的矩阵,初始全部数据都是0,分别对应的是三个不同尺寸的特征图</span></span><br><span class="line">    <span class="hljs-comment"># 矩阵的shape: [height, width , 3, 4 + 1 + num_class + 1],</span></span><br><span class="line">    <span class="hljs-comment"># 最后一维的第一个1表示的是前景后景的标志位,最后一个1表示的是mix up的权重.</span></span><br><span class="line">    y_true_13 = np.zeros((img_size[<span class="hljs-number">1</span>] // <span class="hljs-number">32</span>, img_size[<span class="hljs-number">0</span>] // <span class="hljs-number">32</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span> + class_num), np.float32)</span><br><span class="line">    y_true_26 = np.zeros((img_size[<span class="hljs-number">1</span>] // <span class="hljs-number">16</span>, img_size[<span class="hljs-number">0</span>] // <span class="hljs-number">16</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span> + class_num), np.float32)</span><br><span class="line">    y_true_52 = np.zeros((img_size[<span class="hljs-number">1</span>] // <span class="hljs-number">8</span>, img_size[<span class="hljs-number">0</span>] // <span class="hljs-number">8</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span> + class_num), np.float32)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># mix up weight default to 1.</span></span><br><span class="line">    <span class="hljs-comment"># mix up的权重默认值设置为1</span></span><br><span class="line">    y_true_13[..., <span class="hljs-number">-1</span>] = <span class="hljs-number">1.</span></span><br><span class="line">    y_true_26[..., <span class="hljs-number">-1</span>] = <span class="hljs-number">1.</span></span><br><span class="line">    y_true_52[..., <span class="hljs-number">-1</span>] = <span class="hljs-number">1.</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 将他们放在一起,可以统一操作</span></span><br><span class="line">    y_true = [y_true_13, y_true_26, y_true_52]</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># [N, 1, 2]</span></span><br><span class="line">    <span class="hljs-comment"># 扩展一维,shape: [N, 1, 2]</span></span><br><span class="line">    <span class="hljs-comment"># 需要注意的是,这里的N表示的是目标框的数目,而不是样本的数据.</span></span><br><span class="line">    box_sizes = np.expand_dims(box_sizes, <span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># broadcast tricks</span></span><br><span class="line">    <span class="hljs-comment"># [N, 1, 2] &amp; [9, 2] ==&gt; [N, 9, 2]</span></span><br><span class="line">    <span class="hljs-comment"># 使用numpy的广播机制,很容易计算出目标框和anchor之间的交集部分.</span></span><br><span class="line">    mins = np.maximum(- box_sizes / <span class="hljs-number">2</span>, - anchors / <span class="hljs-number">2</span>)</span><br><span class="line">    maxs = np.minimum(box_sizes / <span class="hljs-number">2</span>, anchors / <span class="hljs-number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># [N, 9, 2]</span></span><br><span class="line">    whs = maxs - mins</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># [N, 9]</span></span><br><span class="line">    <span class="hljs-comment"># 计算每一个目标框和每一个anchor的iou值</span></span><br><span class="line">    iou = (whs[:, :, <span class="hljs-number">0</span>] * whs[:, :, <span class="hljs-number">1</span>]) / (</span><br><span class="line">                box_sizes[:, :, <span class="hljs-number">0</span>] * box_sizes[:, :, <span class="hljs-number">1</span>] + anchors[:, <span class="hljs-number">0</span>] * anchors[:, <span class="hljs-number">1</span>] - whs[:, :, <span class="hljs-number">0</span>] * whs[:, :,</span><br><span class="line">                                                                                                         <span class="hljs-number">1</span>] + <span class="hljs-number">1e-10</span>)</span><br><span class="line">    <span class="hljs-comment"># [N]</span></span><br><span class="line">    <span class="hljs-comment"># 计算每一个目标框和某一个anchor之间的最佳iou值,并返回最佳iou值对应的下标索引</span></span><br><span class="line">    best_match_idx = np.argmax(iou, axis=<span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 这个字典是为了后续的计算方便才定义的</span></span><br><span class="line">    ratio_dict = &#123;<span class="hljs-number">1.</span>: <span class="hljs-number">8.</span>, <span class="hljs-number">2.</span>: <span class="hljs-number">16.</span>, <span class="hljs-number">3.</span>: <span class="hljs-number">32.</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">for</span> i, idx <span class="hljs-keyword">in</span> enumerate(best_match_idx):</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># idx: 0,1,2 ==&gt; 2; 3,4,5 ==&gt; 1; 6,7,8 ==&gt; 0</span></span><br><span class="line">        <span class="hljs-comment"># 根据上面的下标索引,下面的代码可以计算出该目标框应该对应与哪一张特征图.</span></span><br><span class="line">        <span class="hljs-comment"># 因为不同的anchor对应于不同尺寸的特征图,</span></span><br><span class="line">        <span class="hljs-comment"># 所以如果一个目标框和其中一个anchor具有最大的iou,那么我们应该将该目标框和这个anchor对应的特征图联系起来.</span></span><br><span class="line">        feature_map_group = <span class="hljs-number">2</span> - idx // <span class="hljs-number">3</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># scale ratio: 0,1,2 ==&gt; 8; 3,4,5 ==&gt; 16; 6,7,8 ==&gt; 32</span></span><br><span class="line">        <span class="hljs-comment"># 这里就是利用了前面定义的字典,方便的获取缩放倍数</span></span><br><span class="line">        ratio = ratio_dict[np.ceil((idx + <span class="hljs-number">1</span>) / <span class="hljs-number">3.</span>)]</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 计算目标框的中心.这里是指缩放之后的中心</span></span><br><span class="line">        x = int(np.floor(box_centers[i, <span class="hljs-number">0</span>] / ratio))</span><br><span class="line">        y = int(np.floor(box_centers[i, <span class="hljs-number">1</span>] / ratio))</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 根据特征图的编号,获取anchor的下标索引</span></span><br><span class="line">        k = anchors_mask[feature_map_group].index(idx)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 类别标记</span></span><br><span class="line">        c = labels[i]</span><br><span class="line">        <span class="hljs-comment"># print(feature_map_group, '|', y,x,k,c)</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 分别将数据添加到合适的位置,其中需要注意的是k的使用,它表明的是目标框对应的是哪个anchor</span></span><br><span class="line">        <span class="hljs-comment"># 目标框的中心</span></span><br><span class="line">        y_true[feature_map_group][y, x, k, :<span class="hljs-number">2</span>] = box_centers[i]</span><br><span class="line">        <span class="hljs-comment"># 目标框的尺寸</span></span><br><span class="line">        y_true[feature_map_group][y, x, k, <span class="hljs-number">2</span>:<span class="hljs-number">4</span>] = box_sizes[i]</span><br><span class="line">        <span class="hljs-comment"># 前景标记</span></span><br><span class="line">        y_true[feature_map_group][y, x, k, <span class="hljs-number">4</span>] = <span class="hljs-number">1.</span></span><br><span class="line">        <span class="hljs-comment"># 类别标记</span></span><br><span class="line">        y_true[feature_map_group][y, x, k, <span class="hljs-number">5</span> + c] = <span class="hljs-number">1.</span></span><br><span class="line">        <span class="hljs-comment"># mix up权重</span></span><br><span class="line">        y_true[feature_map_group][y, x, k, <span class="hljs-number">-1</span>] = boxes[i, <span class="hljs-number">-1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 当我们处理好所有的目标框之后就返回</span></span><br><span class="line">    <span class="hljs-keyword">return</span> y_true_13, y_true_26, y_true_52</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_data</span><span class="hljs-params">(line, class_num, img_size, anchors, mode)</span>:</span></span><br><span class="line">    <span class="hljs-string">'''</span></span><br><span class="line"><span class="hljs-string">    param:</span></span><br><span class="line"><span class="hljs-string">        line: a line from the training/test txt file</span></span><br><span class="line"><span class="hljs-string">        class_num: totol class nums.</span></span><br><span class="line"><span class="hljs-string">        img_size: the size of image to be resized to. [width, height] format.</span></span><br><span class="line"><span class="hljs-string">        anchors: anchors.</span></span><br><span class="line"><span class="hljs-string">        mode: 'train' or 'val'. When set to 'train', data_augmentation will be applied.</span></span><br><span class="line"><span class="hljs-string">    '''</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 如果line不是一个list，说明这里的line是一个str</span></span><br><span class="line">    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> isinstance(line, list):</span><br><span class="line">        <span class="hljs-comment"># 直接处理即可，返回图片索引，图片路径，以及gt目标框的坐标和对应的labels</span></span><br><span class="line">        img_idx, pic_path, boxes, labels = parse_line(line)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 根据图片路径读取图片</span></span><br><span class="line">        img = cv2.imread(pic_path)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># expand the 2nd dimension, mix up weight default to 1.</span></span><br><span class="line">        <span class="hljs-comment"># 扩展矩阵的维度，这里主要是在每一行的末尾添加一个表示mix up权重的信息，此处默认设置为1</span></span><br><span class="line">        boxes = np.concatenate((boxes, np.full(shape=(boxes.shape[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>), fill_value=<span class="hljs-number">1.</span>, dtype=np.float32)), axis=<span class="hljs-number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">else</span>:</span><br><span class="line">        <span class="hljs-comment"># the mix up case</span></span><br><span class="line">        <span class="hljs-comment"># 如果line表示的是一个list，说明需要使用mix up策略</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 处理第一张图片</span></span><br><span class="line">        _, pic_path1, boxes1, labels1 = parse_line(line[<span class="hljs-number">0</span>])</span><br><span class="line">        <span class="hljs-comment"># 读取第一张图片</span></span><br><span class="line">        img1 = cv2.imread(pic_path1)</span><br><span class="line">        <span class="hljs-comment"># 处理第二张图片</span></span><br><span class="line">        img_idx, pic_path2, boxes2, labels2 = parse_line(line[<span class="hljs-number">1</span>])</span><br><span class="line">        <span class="hljs-comment"># 读取第二张图片</span></span><br><span class="line">        img2 = cv2.imread(pic_path2)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 将他们混合在一起</span></span><br><span class="line">        img, boxes = mix_up(img1, img2, boxes1, boxes2)</span><br><span class="line"></span><br><span class="line">        labels = np.concatenate((labels1, labels2))</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 如果是训练阶段，则会做一些数据增强的操作，如随机颜色抖动，随机裁剪，随机翻转等操作</span></span><br><span class="line">    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">'train'</span>:</span><br><span class="line">        <span class="hljs-comment"># random color jittering</span></span><br><span class="line">        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> applying color distort may lead to bad performance sometimes</span></span><br><span class="line">        <span class="hljs-comment"># img = random_color_distort(img)</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># random expansion with prob 0.5</span></span><br><span class="line">        <span class="hljs-keyword">if</span> np.random.uniform(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>) &gt; <span class="hljs-number">0.5</span>:</span><br><span class="line">            img, boxes = random_expand(img, boxes, <span class="hljs-number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># random cropping</span></span><br><span class="line">        h, w, _ = img.shape</span><br><span class="line">        boxes, crop = random_crop_with_constraints(boxes, (w, h))</span><br><span class="line">        x0, y0, w, h = crop</span><br><span class="line">        img = img[y0: y0+h, x0: x0+w]</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># resize with random interpolation</span></span><br><span class="line">        h, w, _ = img.shape</span><br><span class="line">        interp = np.random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>)</span><br><span class="line">        img, boxes = resize_with_bbox(img, boxes, img_size[<span class="hljs-number">0</span>], img_size[<span class="hljs-number">1</span>], interp)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># random horizontal flip</span></span><br><span class="line">        h, w, _ = img.shape</span><br><span class="line">        img, boxes = random_flip(img, boxes, px=<span class="hljs-number">0.5</span>)</span><br><span class="line">    <span class="hljs-keyword">else</span>:</span><br><span class="line">        img, boxes = resize_with_bbox(img, boxes, img_size[<span class="hljs-number">0</span>], img_size[<span class="hljs-number">1</span>], interp=<span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 将颜色的通道顺序进行更改</span></span><br><span class="line">    img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB).astype(np.float32)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 规范化数据至0~1</span></span><br><span class="line">    <span class="hljs-comment"># the input of yolo_v3 should be in range 0~1</span></span><br><span class="line">    img = img / <span class="hljs-number">255.</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 将给出的gt 目标框进行处理，返回对应的gt矩阵，用以后面的损失计算。</span></span><br><span class="line">    y_true_13, y_true_26, y_true_52 = process_box(boxes, labels, img_size, class_num, anchors)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 返回</span></span><br><span class="line">    <span class="hljs-keyword">return</span> img_idx, img, y_true_13, y_true_26, y_true_52</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_batch_data</span><span class="hljs-params">(batch_line, class_num, img_size, anchors, mode, multi_scale=False, mix_up=False, interval=<span class="hljs-number">10</span>)</span>:</span></span><br><span class="line">    <span class="hljs-string">'''</span></span><br><span class="line"><span class="hljs-string">    generate a batch of imgs and labels</span></span><br><span class="line"><span class="hljs-string">    param:</span></span><br><span class="line"><span class="hljs-string">        batch_line: a batch of lines from train/val.txt files</span></span><br><span class="line"><span class="hljs-string">        class_num: num of total classes.</span></span><br><span class="line"><span class="hljs-string">        img_size: the image size to be resized to. format: [width, height].</span></span><br><span class="line"><span class="hljs-string">        anchors: anchors. shape: [9, 2].</span></span><br><span class="line"><span class="hljs-string">        mode: 'train' or 'val'. if set to 'train', data augmentation will be applied.</span></span><br><span class="line"><span class="hljs-string">        multi_scale: whether to use multi_scale training, img_size varies from [320, 320] to [640, 640] by default. Note that it will take effect only when mode is set to 'train'.</span></span><br><span class="line"><span class="hljs-string">        interval: change the scale of image every interval batches. Note that it's indeterministic because of the multi threading.</span></span><br><span class="line"><span class="hljs-string">    '''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 全局的计数器</span></span><br><span class="line">    <span class="hljs-keyword">global</span> iter_cnt</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># multi_scale training</span></span><br><span class="line">    <span class="hljs-comment"># 是否使用多种尺寸进行训练， 默认是False</span></span><br><span class="line">    <span class="hljs-keyword">if</span> multi_scale <span class="hljs-keyword">and</span> mode == <span class="hljs-string">'train'</span>:</span><br><span class="line">        <span class="hljs-comment"># 设置随机数种子</span></span><br><span class="line">        random.seed(iter_cnt // interval)</span><br><span class="line">        <span class="hljs-comment"># 设定选择范围，并随机采样</span></span><br><span class="line">        random_img_size = [[x * <span class="hljs-number">32</span>, x * <span class="hljs-number">32</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)]</span><br><span class="line">        img_size = random.sample(random_img_size, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 计数器加1</span></span><br><span class="line">    iter_cnt += <span class="hljs-number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 用以保存数据的list</span></span><br><span class="line">    img_idx_batch, img_batch, y_true_13_batch, y_true_26_batch, y_true_52_batch = [], [], [], [], []</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># mix up strategy</span></span><br><span class="line">    <span class="hljs-comment"># 是否使用mix up策略，默认是False</span></span><br><span class="line">    <span class="hljs-keyword">if</span> mix_up <span class="hljs-keyword">and</span> mode == <span class="hljs-string">'train'</span>:</span><br><span class="line">        mix_lines = []</span><br><span class="line">        batch_line = batch_line.tolist()</span><br><span class="line">        <span class="hljs-keyword">for</span> idx, line <span class="hljs-keyword">in</span> enumerate(batch_line):</span><br><span class="line">            <span class="hljs-keyword">if</span> np.random.uniform(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0.5</span>:</span><br><span class="line">                mix_lines.append([line, random.sample(batch_line[:idx] + batch_line[idx+<span class="hljs-number">1</span>:], <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]])</span><br><span class="line">            <span class="hljs-keyword">else</span>:</span><br><span class="line">                mix_lines.append(line)</span><br><span class="line">        batch_line = mix_lines</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 对一个batch中的数据，这里的line一般指的是一行文本数据</span></span><br><span class="line">    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> batch_line:</span><br><span class="line">        <span class="hljs-comment"># 处里数据中的信息，主要是数据索引（一般用不上）图片的像素矩阵，不同特征图所对应的gt信息。</span></span><br><span class="line">        img_idx, img, y_true_13, y_true_26, y_true_52 = parse_data(line, class_num, img_size, anchors, mode)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 附加到这些list的末尾</span></span><br><span class="line">        img_idx_batch.append(img_idx)</span><br><span class="line">        img_batch.append(img)</span><br><span class="line">        y_true_13_batch.append(y_true_13)</span><br><span class="line">        y_true_26_batch.append(y_true_26)</span><br><span class="line">        y_true_52_batch.append(y_true_52)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 使用numpy处理一下</span></span><br><span class="line">    img_idx_batch, img_batch, y_true_13_batch, y_true_26_batch, y_true_52_batch = np.asarray(img_idx_batch, np.int64), np.asarray(img_batch), np.asarray(y_true_13_batch), np.asarray(y_true_26_batch), np.asarray(y_true_52_batch)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 返回</span></span><br><span class="line">    <span class="hljs-keyword">return</span> img_idx_batch, img_batch, y_true_13_batch, y_true_26_batch, y_true_52_batch</span><br></pre></td></tr></table></figure></p>

        </div>
        
            <ul class="post-copyright">
            <li><strong>本文标题：</strong><a href="http://huaxuan0720.github.io/2019/05/22/Note13-YOLOv3-part07/">YOLOv3源码阅读：data_utils.py</a></li>
            <li><strong>本文作者：</strong><a href="http://huaxuan0720.github.io">Da Vinci</a></li>
            <li><strong>本文链接：</strong><a href="http://huaxuan0720.github.io/2019/05/22/Note13-YOLOv3-part07/">http://huaxuan0720.github.io/2019/05/22/Note13-YOLOv3-part07/</a></li>
            <li><strong>发布时间：</strong>2019-05-22</li>
            <li><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
            </li>
            </ul>
        
        
        <hr style="height:1px;margin:1rem 0">
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <i class="fas fa-tags has-text-grey"></i>&nbsp;
                    <a class="has-link-grey -link" href="/tags/YOLOv3/">YOLOv3</a>,&nbsp;<a class="has-link-grey -link" href="/tags/深度学习/">深度学习</a>,&nbsp;<a class="has-link-grey -link" href="/tags/目标检测/">目标检测</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">Like this article? Support the author with</h3>
        <div class="buttons is-centered">
            
                
<a class="button is-info donate">
    <span class="icon is-small">
        <i class="fab fa-alipay"></i>
    </span>
    <span>Alipay</span>
    <div class="qrcode"><img src="/images/alipay.jpg" alt="Alipay"></div>
</a>

                
                
<a class="button is-success donate">
    <span class="icon is-small">
        <i class="fab fa-weixin"></i>
    </span>
    <span>Wechat</span>
    <div class="qrcode"><img src="/images/wechat.jpg" alt="Wechat"></div>
</a>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2019/05/24/Note14-ConvBackProp-part1/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">步长stride为1的二维卷积方法的反向传播算法</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2019/05/22/Note13-YOLOv3-part06/">
                <span class="level-item">YOLOv3源码阅读：train.py</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">Comments</h3>
        
<div id="valine-thread" class="content"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
    new Valine({
        el: '#valine-thread' ,
        notify: true,
        verify: false,
        app_id: 'iccwxYBr9y70NgcI4taslyB9-gzGzoHsz',
        app_key: 'ksGgGN0AeLXQQ1HfOy0mCrM0',
        placeholder: 'xxxxxxxx'
    });
</script>

    </div>
</div>

</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level" style="margin-bottom:1rem">
            <div class="level-item has-text-centered">
                <div>
                    
                        <img class="image is-96x96 has-mb-6" src="/images/icon.jpg" alt="Da Vinci">
                    
                    
                    <p class="is-size-4 is-block">
                        Da Vinci
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        A Student
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Hangzhou Zhejiang, China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level menu-list is-mobile" style="margin-bottom:1rem">
            <div class="level-item has-text-centered is-marginless">
                <a href="/archives/">
                    <p class="heading">
                        Posts
                    </p>
                    <p class="title has-text-weight-normal">
                        41
                    </p>
                </a>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <a href="/categories/">
                    <p class="heading">
                        Categories
                    </p>
                    <p class="title has-text-weight-normal">
                        3
                    </p>
                </a>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <a href="/tags/">
                    <p class="heading">
                        Tags
                    </p>
                    <p class="title has-text-weight-normal">
                        23
                    </p>
                </a>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/huaxuan0720" target="_blank">
                <i class="fab fa-github"></i>&nbsp;&nbsp;Follow</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Github" href="https://github.com/huaxuan0720">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Facebook" href="/">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Twitter" href="/">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>

    
        
<div class="card widget column-left is-sticky" id="toc">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Catalogue
            </h3>
            <ul class="menu-list"><li>
        <a class="is-flex" href="#一yolo简介">
        <span class="has-mr-6">1</span>
        <span>一、YOLO简介</span>
        </a></li><li>
        <a class="is-flex" href="#二代码和注释">
        <span class="has-mr-6">2</span>
        <span>二、代码和注释</span>
        </a></li></ul>
        </div>
    </div>
</div>


    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/favicon.svg" alt="YOLOv3源码阅读：data_utils.py" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 Da Vinci&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a href="http://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                <br>
                <span id="busuanzi_container_site_uv">
                Visited by <span id="busuanzi_value_site_uv">0</span> users
                </span>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                        
                        <i class="fab fa-creative-commons"></i>&nbsp;<i class="fab fa-creative-commons-by"></i>&nbsp;<i class="fab fa-creative-commons-nc"></i>&nbsp;<i class="fab fa-creative-commons-sa"></i>&nbsp;
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Xuan Hua&#39;s GitHub" href="https://www.github.com/huaxuan0720">
                        
                        <i class="fab fa-github"></i>&nbsp;
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    

    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>